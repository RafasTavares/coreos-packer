
#-----------------------|DOCUMENTATION|-----------------------#
# @descr: Ignition for creating SSH access keys and user access 
#         settings, updating the operating system.
# @fonts: https://coreos.com/os/docs/latest/provisioning.html
#         https://coreos.com/os/docs/latest/migrating-to-clcs.html
#         https://coreos.com/os/docs/latest/adding-users.html
#         https://coreos.com/os/docs/latest/update-strategies.html
#         https://coreos.com/os/docs/latest/customizing-sshd.html
#         https://coreos.com/os/docs/latest/using-environment-variables-in-systemd-units.html#system-wide-environment-variables
#         https://coreos.com/os/docs/latest/other-settings.html#adding-custom-messages-to-motd
#-------------------------------------------------------------#

passwd:
  users:
    - name: "core"
      # Vagrant insecure public key.
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"

    - name: "lucifer"
      # Vagrant insecure public key.
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"

    - name: "packer"
      # Vagrant insecure public key.
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"
        
    - name: "vagrant"
      # Output Data:(Last Algorithm: crypt3-md5)-(pass: vagrant).
      password_hash: "$1$iK1XY6BH$s504GuI.QIZYBqMRDMwFr1"
      # Vagrant insecure public key.
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"
      home_dir: "/home/vagrant"
      no_create_home: false
      groups:
        - "sudo"
        - "docker"
      shell: "/bin/bash"
    
    - name: "ansible"
      # Vagrant insecure public key.
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"
      home_dir: "/home/ansible"
      no_create_home: false
      groups:
        - "sudo"
        - "docker"
      shell: "/bin/bash"

# WARNING: When you change the RELEASE of CoreOS, you should also change thes 
# files "Makefile OR Makefile.test" for "COREOS_RELEASE=stable"
update:
  group: "stable"

locksmith:
  reboot_strategy: "etcd-lock"
  window_start: "Sun 0:33"
  window_length: "3h"

storage:
  files:
    - path: "/etc/ssh/sshd_config"
      filesystem: "root"
      mode: 0600
      contents:
        inline: |
          # Apply to users: (core, lucifer, packer, vagrant, ansible).
          AllowUsers core lucifer packer vagrant ansible
          AuthenticationMethods publickey
          UseDNS no
          PermitRootLogin no
          PasswordAuthentication no
          ChallengeResponseAuthentication no
          Subsystem sftp internal-sftp

    - path: "/etc/sudoers.d/packer"
      filesystem: "root"
      mode: 0644
      user:
        id: 0
      group:
        id: 0
      contents:
        inline: "packer ALL=(ALL) NOPASSWD: ALL"

    - path: "/etc/sudoers.d/vagrant"
      filesystem: "root"
      mode: 0644
      user:
        id: 0
      group:
        id: 0
      contents:
        inline: "vagrant ALL=(ALL) NOPASSWD: ALL"

    - path: "/etc/sudoers.d/ansible"
      filesystem: "root"
      mode: 0644
      user:
        id: 0
      group:
        id: 0
      contents:
        inline: "ansible ALL=(ALL) NOPASSWD: ALL"

    - path: "/etc/profile.d/motd.sh"
      filesystem: "root"
      mode: 0644
      contents:
        inline: |
          #!/bin/bash
          echo -e "\033[01;32m";
          cat <<'EOF'
          Project 'https://github.com/alisonbuss/coreos-packer/'                
               ____                ___  ____    ____            _                
              / ___|___  _ __ ___ / _ \/ ___|  |  _ \ __ _  ___| | _____ _ __    
             | |   / _ \| '__/ _ \ | | \___ \  | |_) / _` |/ __| |/ / _ \ '__|   
             | |__| (_) | | |  __/ |_| |___) | |  __/ (_| | (__|   <  __/ |      
              \____\___/|_|  \___|\___/|____/  |_|   \__,_|\___|_|\_\___|_|      
                                                                                 
          ........................................Image generated by Packer......
          EOF
          echo -e "\033[00m";
